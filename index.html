<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@700&family=Roboto:wght@400;500;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./css/main.min.css">
</head>

<body class="page">
    <!--верхняя линия хедер-->
    <header class="page-header">
        <div class="conteiner page-header__conteiner">
            <!--раздел основной навигации-->
            <nav class="main-nav">
                <!--логотип хедер-->
                <a href="./index.html" class="logo">
                    <span class="logo__accent">Drained Planet</span>
                </a>
            </nav>
        </div>
    </header>

    <main>
        <!--Шапка-->
        <section class="hero-section">
                <div class="conteiner page-hero__conteiner">
                    <div class="motion-container">
                    
                        <!-- drawing svg path -->
                        <svg class="svg" xmlns="http://www.w3.org/2000/svg" width="1200" height="600">
                            <path id="svg_path"
                                d="m599.99997,504.50003c-271.82319,0 -491.99998,-91.51658 -491.99998,-204.50001c0,-112.98343 220.17679,-204.50001 491.99998,-204.50001c271.82319,0 491.99998,91.51658 491.99998,204.50001c0,112.98343 -220.17679,204.50001 -491.99998,204.50001z"
                                stroke="none" fill="none" />
                        </svg>

                        <!-- object to move -->
                        <ul class="list">
                            <li class="box box-1 target-1">1</li>
                            <li class="box box-2 target-2">2</li>
                            <li class="box box-3 target-3">3</li>
                            <li class="box box-4 target-4">4</li>
                            <li class="box box-5 target-5">5</li>
                            <li class="box box-6 target-6">6</li>
                        </ul>
                    
                    </div>
                    
                    <button type="button" class="btnMove">
                        move
                    </button>

                    <div class="label visibilitychange-log">animation progress 0%</div>
                </div>
        </section>
    </main>

    <!--подвал-->
    <footer class="page-footer">
        <div class="conteiner page-footer__conteiner">
            <!-- наши соцсети  -->
            <div class="our-social-networks">
                <ul class="social-links list">
                
                    <li class="social-links__item social-links__item--top">
                        <a class="social-links__link social-links__link--color" href="">
                            Twitter
                            <!-- <svg class="social-links__icon" width="20" height="20">
                                <use href="./images/icons.svg#instagram"></use>
                            </svg> -->
                        </a>
                    </li>
                    
                    <li class="social-links__item social-links__item--top">
                        <a class="social-links__link social-links__link--color" href="">
                            Discord
                            <!-- <svg class="social-links__icon" width="20" height="20">
                                <use href="./images/icons.svg#twitter"></use>
                            </svg> -->
                        </a>
                    </li>
                
                    <li class="social-links__item social-links__item--top">
                        <a class="social-links__link social-links__link--color" href="">
                            OpenSea
                            <!-- <svg class="social-links__icon" width="20" height="20">
                                <use href="./images/icons.svg#facebook"></use>
                            </svg> -->
                        </a>
                    </li>
                
                </ul>
            </div>
        </div>
    </footer>

    <script src="js/snap.svg-min.js"></script>
    <script src="js/anime.min.js"></script>

    <script>
        const btnMove = document.querySelector('.btnMove');
        const visibilitychangeLogEl = document.querySelector('.visibilitychange-log');
        // const svgPath = document.querySelector('.svg-path');

        let disabled = false;
        let limit = 1;

        // Создание объекта Snap из SVG-элемента
        var s = Snap(".svg");

        // Получение элемента path
        var path = s.select("#svg_path");

        // Получение общей длины path
        var pathLength = Snap.path.getTotalLength(path);

        // Разбиение path на 6 сегментов
        var segmentLengths = [
            pathLength * 0.25,
            pathLength * 0.125,
            pathLength * 0.125,
            pathLength * 0.25,
            pathLength * 0.125,
            pathLength * 0.125
        ];

        // Получение начала и конца каждого сегмента
        var segmentStartsAndEnds = [
            [0, segmentLengths[0]],
            [segmentLengths[0], segmentLengths[0] + segmentLengths[1]],
            [segmentLengths[0] + segmentLengths[1], segmentLengths[0] + segmentLengths[1] + segmentLengths[2]],
            [segmentLengths[0] + segmentLengths[1] + segmentLengths[2], segmentLengths[0] + segmentLengths[1] + segmentLengths[2] + segmentLengths[3]],
            [segmentLengths[0] + segmentLengths[1] + segmentLengths[2] + segmentLengths[3], segmentLengths[0] + segmentLengths[1] + segmentLengths[2] + segmentLengths[3] + segmentLengths[4]],
            [segmentLengths[0] + segmentLengths[1] + segmentLengths[2] + segmentLengths[3] + segmentLengths[4], pathLength]
        ];

        // Создание новых path для каждого сегмента
        for (var i = 0; i < segmentStartsAndEnds.length; i++) {
            var segment = Snap.path.getSubpath(path, segmentStartsAndEnds[i][0], segmentStartsAndEnds[i][1]);
            var segmentPath = s.path(segment);
            // Установка атрибутов каждого сегмента
            segmentPath.attr({
                id: `svg_${i + 1}`,
                fill: "none",
                stroke: "#000",
                strokeWidth: 1
            });
        }

        //anime.js
        let path1 = anime.path('.svg #svg_1');
        let path2 = anime.path('.svg #svg_2');
        let path3 = anime.path('.svg #svg_3');
        let path4 = anime.path('.svg #svg_4');
        let path5 = anime.path('.svg #svg_5');
        let path6 = anime.path('.svg #svg_6');

        let motionMave1 = anime({
            targets: ".target-1",
            translateX: path1('x'),
            translateY: path1('y'),
            autoplay: false,
        });

        let motionMave2 = anime({
            targets: ".target-2",
            translateX: path2('x'),
            translateY: path2('y'),
            autoplay: false,
        });

        let motionMave3 = anime({
            targets: ".target-3",
            translateX: path3('x'),
            translateY: path3('y'),
            autoplay: false,
        });

        let motionMave4 = anime({
            targets: ".target-4",
            translateX: path4('x'),
            translateY: path4('y'),
            autoplay: false,
        });

        let motionMave5 = anime({
            targets: ".target-5",
            translateX: path5('x'),
            translateY: path5('y'),
            autoplay: false,
        });

        let motionMave6 = anime({
            targets: ".target-6",
            translateX: path6('x'),
            translateY: path6('y'),
            autoplay: false,
        });

        const changePath = (motionMove, target, path) => {
            motionMove = anime({
                targets: target,
                translateX: path('x'),
                translateY: path('y'),
                duration: 1000,
                direction: 'reverse',
                easing: 'easeInOutSine',
                autoplay: false,
                update: function (a) {
                    // visibilitychangeLogEl.innerHTML = 'animation progress ' + Math.round(a.progress) + '%';
                },
                complete: function (a) {
                    disabled = false;
                }
            });
            motionMove.play();
        }

        btnMove.addEventListener('click', async e => {
            e.preventDefault();

            if (disabled) return;

            if (e.target.tagName !== 'BUTTON') return;

            disabled = true;

            if (limit === 1) {
                changePath(motionMave1, ".target-2", path1);
                changePath(motionMave2, ".target-3", path2);
                changePath(motionMave3, ".target-4", path3);
                changePath(motionMave4, ".target-5", path4);
                changePath(motionMave5, ".target-6", path5);
                changePath(motionMave6, ".target-1", path6);
            }
            if (limit === 2) {
                changePath(motionMave1, ".target-3", path1);
                changePath(motionMave2, ".target-4", path2);
                changePath(motionMave3, ".target-5", path3);
                changePath(motionMave4, ".target-6", path4);
                changePath(motionMave5, ".target-1", path5);
                changePath(motionMave6, ".target-2", path6);
            }
            if (limit === 3) {
                changePath(motionMave1, ".target-4", path1);
                changePath(motionMave2, ".target-5", path2);
                changePath(motionMave3, ".target-6", path3);
                changePath(motionMave4, ".target-1", path4);
                changePath(motionMave5, ".target-2", path5);
                changePath(motionMave6, ".target-3", path6);
            }
            if (limit === 4) {
                changePath(motionMave1, ".target-5", path1);
                changePath(motionMave2, ".target-6", path2);
                changePath(motionMave3, ".target-1", path3);
                changePath(motionMave4, ".target-2", path4);
                changePath(motionMave5, ".target-3", path5);
                changePath(motionMave6, ".target-4", path6);
            }
            if (limit === 5) {
                changePath(motionMave1, ".target-6", path1);
                changePath(motionMave2, ".target-1", path2);
                changePath(motionMave3, ".target-2", path3);
                changePath(motionMave4, ".target-3", path4);
                changePath(motionMave5, ".target-4", path5);
                changePath(motionMave6, ".target-5", path6);
            }
            if (limit === 6) {
                changePath(motionMave1, ".target-1", path1);
                changePath(motionMave2, ".target-2", path2);
                changePath(motionMave3, ".target-3", path3);
                changePath(motionMave4, ".target-4", path4);
                changePath(motionMave5, ".target-5", path5);
                changePath(motionMave6, ".target-6", path6);
            }

            if (limit === 6) {
                limit = 1;
            } else {
                limit += 1;
            }
        });
    </script>

</body>

</html>